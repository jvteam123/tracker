<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>123 PH Forecast</title>
    <!-- Load Orbitron font for the title -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@600;800&display=swap" rel="stylesheet">
    <!-- Load Roboto Mono font for the subtitle -->
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Mono:ital,wght@0,300;1,300&display=swap" rel="stylesheet">
    <!-- Load Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'dark-bg': '#1e293b',    // Slate-800 equivalent
                        'dark-card': '#334155',  // Slate-700 equivalent
                        'primary-blue': '#3b82f6', // Blue-500
                    },
                    fontFamily: {
                        sans: ['Inter', 'sans-serif'],
                        // New font family for the title
                        orbitron: ['Orbitron', 'sans-serif'], 
                        // New font family for the subtitle
                        mono: ['Roboto Mono', 'monospace'],
                    },
                }
            }
        }
    </script>
    <style>
        /*
         * CORE FIX: Set body to full screen height and use flex column layout.
         * The #windy-container will now use 'flex-grow' to consume remaining space.
         */
        body {
            height: 100vh; /* Ensures the body occupies the entire viewport height */
        }
        
        #windy-container {
            /* flex-grow: 1 makes it take up all available vertical space */
            flex-grow: 1; 
            /* h-0 is necessary for flex-grow to work correctly in a column layout */
            height: 0; 
            width: 100%;
            border-radius: 1rem; /* More rounded corners */
            overflow: hidden;
            /* Stronger shadow, blending with dark background */
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.7); 
            position: relative; 
            border: 2px solid #3b82f6; /* Subtle blue border for emphasis */
            min-height: 300px; /* Ensure map is still visible on very small screens */
            transition: all 0.3s ease-in-out;
        }

        /* Ensure the container takes up the full viewport when in fullscreen mode */
        #windy-container:fullscreen {
            border-radius: 0;
            margin: 0;
            padding: 0;
            width: 100vw;
            height: 100vh;
            border: none;
            box-shadow: none;
        }
        /* Style the iframe to fill the container */
        #windy-iframe {
            width: 100%;
            height: 100%;
            border: none;
        }
    </style>
</head>
<!-- Updated body classes for guaranteed screen fit (h-screen and flex-col) -->
<body class="bg-dark-bg bg-gradient-to-br from-slate-900 via-dark-bg to-slate-900 flex flex-col items-center p-4 sm:p-10 font-sans text-white">

    <div class="max-w-6xl w-full flex flex-col h-full"> <!-- Added h-full to inner div -->
        <!-- Header Section -->
        <header class="text-center mb-6 p-4 flex-shrink-0">
            <!-- Title updated with Orbitron font, slightly smaller size, and less bold -->
            <h1 class="text-3xl sm:text-4xl font-orbitron font-semibold text-primary-blue mb-2 tracking-wider">
                123 PH Forecast
            </h1>
            <!-- Subtitle updated with Roboto Mono font and adjusted style -->
            <p class="text-slate-400 text-sm sm:text-base font-mono font-light italic opacity-90">
                Real-time, stunning visualization powered by Windy
            </p>
        </header>
        
        <!-- Toggle Switch and Fullscreen Button Group (MOBILE OPTIMIZED) -->
        <div class="flex justify-center mb-6 flex-shrink-0">
            <div class="flex flex-col sm:flex-row items-center space-y-3 sm:space-y-0 sm:space-x-4 bg-dark-card p-3 rounded-xl shadow-lg border border-slate-600">
                
                <!-- View Toggle Button -->
                <div class="inline-flex items-center space-x-3">
                    <span id="current-view-label" class="text-sm font-medium text-slate-300 hidden md:block">Default View: Satellite Layer</span>
                    <button 
                        id="toggle-satellite" 
                        onclick="toggleView()" 
                        class="px-4 py-2 text-sm font-semibold rounded-full transition-all duration-300 bg-primary-blue text-white shadow-md hover:bg-blue-600 active:scale-95"
                        data-current-view="satellite"
                    >
                        Switch to Wind Layer
                    </button>
                </div>

                <!-- Fullscreen Button - Adjusted for full width on mobile (w-full) -->
                <button 
                    id="fullscreen-button" 
                    onclick="toggleFullscreen()" 
                    class="py-2 px-3 text-sm font-semibold rounded-full transition-all duration-300 bg-slate-600 text-white shadow-md hover:bg-slate-700 active:scale-95 flex items-center justify-center space-x-1 w-full sm:w-auto"
                    aria-label="Toggle Fullscreen"
                >
                    <span id="fs-icon-container">
                        <!-- Initial Enter Fullscreen Icon (will be replaced by JS) -->
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m7-11v4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5"></path></svg>
                    </span>
                    <span id="fs-text">Fullscreen</span>
                </button>
            </div>
        </div>


        <!-- Windy Map Container (Now using flex-grow: 1) -->
        <div id="windy-container" class="transition-all duration-300 hover:shadow-xl">
            <iframe 
                id="windy-iframe"
                src="" 
                title="Windy Weather Map"
                loading="lazy"
            ></iframe>
        </div>

        <!-- Footer / Credits (flex-shrink-0 prevents it from being compressed) -->
        <footer class="mt-8 text-center text-sm text-slate-500 flex-shrink-0">
            <p>Weather forecast and visualization powered by Windy.</p>
            <p class="mt-1 text-xs opacity-75">For educational and development purposes only.</p>
        </footer>
    </div>

    <!-- 
        ========================================
        IFRAME WIDGET SCRIPT
        ========================================
    -->
    <script>
        // --- API Key (still used to unlock advanced features in the iFrame) ---
        const W_API_KEY = '9CbzreShuP283Fr5d8cuaqUBl37zeFcv';
        const MAP_BASE_URL = "https://embed.windy.com/embed2.html";
        const MAP_DEFAULT_OVERLAY = 'satellite'; 

        /**
         * Initializes the Windy iFrame with current settings.
         * @param {string} overlay - The weather overlay to display (e.g., 'satellite', 'wind', 'temp').
         */
        function initializeWindyIFrame(overlay = MAP_DEFAULT_OVERLAY) {
            
            // Define map parameters (customized for the Philippines)
            const params = new URLSearchParams({
                // Required parameters
                key: W_API_KEY,               // Your API Key
                lat: 12.88,                   // Center Latitude (Philippines)
                lon: 121.77,                  // Center Longitude (Philippines)
                zoom: 5,                      // Increased zoom to cover the whole country
                
                // Visualization and UI options
                current: 'true',              // Display current conditions
                overlay: overlay,             // Initial overlay - now dynamic
                product: 'gfs',               // Forecast model (only relevant for wind/temp overlays)
                menu: 'true', 
                header: 'dark', 
                
                // Other display options
                calendar: 'false',
                clouds: 'false',
                marker: 'false',
                detail: 'false',
                height: '100%',
                width: '100%',
            });

            const iframe = document.getElementById('windy-iframe');
            iframe.src = `${MAP_BASE_URL}?${params.toString()}`;
            console.log("iFrame source set:", iframe.src);
        }

        /**
         * Toggles between Satellite and Wind view.
         */
        function toggleView() {
            const button = document.getElementById('toggle-satellite');
            const label = document.getElementById('current-view-label');
            let currentView = button.getAttribute('data-current-view');
            let newView;
            let buttonText;
            let labelText;
            
            if (currentView === 'satellite') {
                newView = 'wind';
                buttonText = 'Switch to Satellite View';
                labelText = 'Current View: Wind Layer';
            } else {
                newView = 'satellite';
                buttonText = 'Switch to Wind Layer';
                labelText = 'Current View: Satellite Layer';
            }
            
            button.setAttribute('data-current-view', newView);
            button.textContent = buttonText;
            label.textContent = labelText;
            initializeWindyIFrame(newView);
        }

        // ===================================
        // FULLSCREEN LOGIC
        // ===================================

        // SVG Path for Enter Fullscreen
        const FS_ENTER_SVG = `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 8V4m0 0h4M4 4l5 5m7-11v4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5v-4m0 4h-4m4 0l-5-5"></path></svg>`;
        
        // SVG Path for Exit Fullscreen (a cleaner, general exit icon)
        const FS_EXIT_SVG = `<svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path></svg>`;

        /**
         * Toggles the map container into and out of fullscreen mode.
         */
        function toggleFullscreen() {
            const container = document.getElementById('windy-container');
            
            if (document.fullscreenElement) {
                // Exit fullscreen
                if (document.exitFullscreen) {
                    document.exitFullscreen();
                }
            } else {
                // Enter fullscreen
                if (container.requestFullscreen) {
                    container.requestFullscreen();
                }
            }
        }

        /**
         * Updates the fullscreen button appearance based on current fullscreen status.
         */
        function updateFullscreenButton() {
            const button = document.getElementById('fullscreen-button');
            const iconContainer = document.getElementById('fs-icon-container');
            const textSpan = document.getElementById('fs-text');
            
            if (document.fullscreenElement) {
                // Currently in fullscreen
                iconContainer.innerHTML = FS_EXIT_SVG;
                textSpan.textContent = 'Exit FS';
                button.classList.replace('bg-slate-600', 'bg-red-500'); 
                button.classList.replace('hover:bg-slate-700', 'hover:bg-red-600');
            } else {
                // Not in fullscreen
                iconContainer.innerHTML = FS_ENTER_SVG;
                textSpan.textContent = 'Fullscreen';
                button.classList.replace('bg-red-500', 'bg-slate-600');
                button.classList.replace('hover:bg-red-600', 'hover:bg-slate-700');
            }
        }

        // Attach event listeners to catch changes (like pressing ESC)
        document.addEventListener('fullscreenchange', updateFullscreenButton);
        document.addEventListener('webkitfullscreenchange', updateFullscreenButton); // For Safari
        document.addEventListener('mozfullscreenchange', updateFullscreenButton); // For Firefox
        document.addEventListener('msfullscreenchange', updateFullscreenButton); // For IE/Edge

        // Initialize on page load
        window.onload = () => {
            initializeWindyIFrame(MAP_DEFAULT_OVERLAY);
            updateFullscreenButton(); // Set initial button state
        };
    </script>
</body>
</html>
