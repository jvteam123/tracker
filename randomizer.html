<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Area Randomizer - Professional</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Custom Colors */
        .bg-primary { background-color: #3730a3; } /* Deep Indigo */
        .hover\:bg-primary-dark:hover { background-color: #312e81; }
        .text-primary { color: #3730a3; }
        .border-primary { border-color: #3730a3; }
        .ring-primary { --tw-ring-color: #3730a3; }
        
        /* Custom scrollbar for output area (Professional look) */
        #resultTextarea::-webkit-scrollbar {
            width: 8px;
        }
        #resultTextarea::-webkit-scrollbar-thumb {
            background: #94a3b8; /* slate-400 */
            border-radius: 4px;
        }
        #resultTextarea::-webkit-scrollbar-track {
            background: #f1f5f9; /* slate-100 */
        }

        /* General Body and Container Styling */
        body {
            background-color: #f8fafc; /* Lighter background */
        }
        .main-card {
            box-shadow: 0 10px 30px rgba(45, 55, 72, 0.15); /* Stronger, professional shadow */
        }
        
        /* Input and Button Focus Styling */
        .input-focus:focus {
            border-color: #3730a3; /* Deep Indigo */
            box-shadow: 0 0 0 3px rgba(55, 48, 163, 0.3);
        }
        
        /* Selection List Hover Effect */
        #namesSelectionArea > div:hover {
            background-color: #e0e7ff; /* Lighter Indigo for subtle feedback */
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 md:p-10 font-sans antialiased">

    <div class="max-w-4xl mx-auto bg-white main-card rounded-xl p-8 md:p-12 border border-gray-200">

        <header class="text-center mb-10 border-b pb-4">
            <h1 class="text-4xl font-extrabold text-gray-800 tracking-tight">Area Randomizer</h1>
            <p class="text-gray-500 mt-2 text-lg">Manage, save, and randomize assignment lists with persistent storage.</p>
        </header>

        <section class="mb-8 pb-6 border-b border-gray-200">
            <label class="block text-xl font-bold text-gray-700 mb-4">1. Saved List Management</label>
            <div class="flex flex-col sm:flex-row gap-4">
                
                <select id="listSelector" onchange="loadSelectedList()"
                        class="flex-grow p-3 border border-gray-300 rounded-lg input-focus transition duration-150 text-gray-700">
                    <option value="">-- Load or Create a List --</option>
                </select>

                <div class="flex gap-4">
                    <button id="saveListBtn" onclick="saveCurrentList()"
                        class="bg-primary hover:bg-primary-dark text-white font-semibold py-3 px-6 rounded-lg shadow-md transition duration-200 focus:outline-none focus:ring-4 focus:ring-indigo-300 flex-shrink-0">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-6 4v4m0 0l-2-2m2 2l2-2" /></svg>
                        Save
                    </button>

                    <button id="deleteListBtn" onclick="deleteSelectedList()" disabled
                        class="bg-red-600 hover:bg-red-700 text-white font-semibold py-3 px-6 rounded-lg shadow-md transition duration-200 focus:outline-none focus:ring-4 focus:ring-red-300 flex-shrink-0 disabled:opacity-50 disabled:cursor-not-allowed">
                        <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16" /></svg>
                        Delete
                    </button>
                </div>
            </div>
        </section>


        <section class="mb-8 pb-6 border-b border-gray-200">
            <div class="flex justify-between items-center mb-4">
                <label for="bulkInput" class="block text-xl font-bold text-gray-700">2. Input List (One Name Per Line)</label>
                <div class="flex items-center">
                    <input type="checkbox" id="loadDefaults" onchange="toggleDefaultNames(this.checked)" 
                           class="h-5 w-5 text-indigo-600 border-gray-400 rounded focus:ring-indigo-500 cursor-pointer">
                    <label for="loadDefaults" class="ml-2 block text-base font-medium text-gray-700 cursor-pointer select-none">Team 123</label>
                </div>
            </div>
            <textarea id="bulkInput" rows="6" placeholder="e.g.,
Alice Johnson
Bob Smith
..."
                class="w-full p-4 border border-gray-300 rounded-lg input-focus transition duration-150 shadow-inner resize-none text-gray-800 text-base"></textarea>

            <div class="flex justify-between mt-4">
                <button onclick="clearBulkInput()"
                    class="bg-gray-300 hover:bg-gray-400 text-gray-800 font-semibold py-2 px-6 rounded-lg shadow-sm transition duration-200 focus:outline-none focus:ring-2 focus:ring-gray-500">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-1" fill="none" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12" /></svg>
                    Clear Input
                </button>
                <button onclick="loadNamesFromBulk(true)"
                    class="bg-primary hover:bg-primary-dark text-white font-semibold py-2 px-6 rounded-lg shadow-md transition duration-200 focus:outline-none focus:ring-4 focus:ring-indigo-300">
                    Refresh Selection
                </button>
            </div>
        </section>

        <section class="mb-8">
            <label class="block text-xl font-bold text-gray-700 mb-3">3. Names to Include (Check to select)</label>
            <div id="namesSelectionArea" 
                 class="p-4 border border-gray-300 rounded-lg bg-gray-50 max-h-72 overflow-y-auto grid grid-cols-2 md:grid-cols-3 gap-3 shadow-inner">
                 <p class="text-gray-500 text-base col-span-full">Names will load here once entered above or retrieved from storage.</p>
            </div>
        </section>


        <div class="flex justify-center mb-10">
            <button id="randomizeButton" onclick="randomizeNames()"
                class="bg-primary hover:bg-primary-dark text-white font-bold py-4 px-10 rounded-xl shadow-lg transition duration-300 ease-in-out transform hover:scale-[1.02] focus:outline-none focus:ring-4 focus:ring-indigo-300 flex items-center text-lg">
                <svg xmlns="http://www.w3.org/2000/svg" class="h-6 w-6 mr-3" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.836 2.582l-5.582 5.582A2 2 0 0113.414 18H10a2 2 0 00-2 2v2M4 13V9a2 2 0 012-2h4l2-2h4l2 2h4a2 2 0 012 2v4a2 2 0 01-2 2h-4l-2 2v2" />
                </svg>
                RANDOMIZE
            </button>
        </div>

        <section>
            <label for="resultTextarea" class="block text-xl font-bold text-gray-700 mb-3">4. Randomized Assignment List</label>
            <div id="resultContainer" class="relative">
                <textarea id="resultTextarea" readonly placeholder="The randomized list will appear here..."
                    class="w-full p-4 h-80 border border-green-400 bg-green-50 rounded-lg shadow-inner resize-none text-green-800 font-mono text-base"></textarea>
                
                <button id="copyButton" onclick="copyResult()" disabled
                    class="absolute top-4 right-4 bg-green-500 hover:bg-green-600 text-white font-semibold py-2 px-4 rounded-lg shadow-md transition duration-150 disabled:opacity-50 disabled:cursor-not-allowed">
                    <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5 inline mr-1" viewBox="0 0 20 20" fill="currentColor">
                        <path d="M7 9a2 2 0 012-2h6a2 2 0 012 2v6a2 2 0 01-2 2H9a2 2 0 01-2-2V9z" />
                        <path d="M5 3a2 2 0 00-2 2v6a2 2 0 002 2V5h8a2 2 0 00-2-2H5z" />
                    </svg>
                    Copy Text
                </button>

                <div id="messageBox" class="absolute bottom-4 left-0 right-0 p-3 mx-4 rounded-lg text-center font-medium transition-opacity duration-300 opacity-0 pointer-events-none text-sm" style="display: none;"></div>
            </div>
        </section>

    </div>

    <script>
        
        // --- LOCAL STORAGE FUNCTIONS AND CONSTANTS ---
        const CURRENT_LIST_KEY = 'areaRandomizerCurrentList';
        const SAVED_LISTS_KEY = 'areaRandomizerSavedLists';
        let saveTimeout;

        const DEFAULT_NAMES = `Lorens Christopher Ebrado
Arjohn Abapo
Hyacinth Hortelano
Jayson Aliser
Joana May Taboada
John Vincent Sison
Kenneth Lester Villajos
Nazareno Oppus
Serg Sembrano
Negel Roloma
Vince April Pitogo`;

        // Utility to get all saved lists
        function getSavedLists() {
            try {
                return JSON.parse(localStorage.getItem(SAVED_LISTS_KEY)) || {};
            } catch (e) {
                console.error("Error loading saved lists:", e);
                return {};
            }
        }

        // Utility to populate the list selector dropdown
        function populateListSelector(selectedListName = "") {
            const selector = document.getElementById('listSelector');
            const savedLists = getSavedLists();
            
            selector.innerHTML = `<option value="">-- Load or Create a List --</option>`;
            selector.disabled = Object.keys(savedLists).length === 0;
            document.getElementById('deleteListBtn').disabled = true;

            const listNames = Object.keys(savedLists).sort();
            listNames.forEach(name => {
                const option = document.createElement('option');
                option.value = name;
                option.textContent = name;
                selector.appendChild(option);
            });
            
            if (selectedListName) {
                 selector.value = selectedListName;
            }
        }
        
        // --- Persistence and Utility Functions ---

        function saveCurrentInput(names) {
             localStorage.setItem(CURRENT_LIST_KEY, names);
        }

        function loadNamesFromLocalStorage() {
            const bulkInput = document.getElementById('bulkInput');
            const loadDefaultsCheckbox = document.getElementById('loadDefaults');
            const savedNames = localStorage.getItem(CURRENT_LIST_KEY);
            
            if (savedNames !== null) {
                bulkInput.value = savedNames;
                
                // FIX: Check if the loaded content matches the default list to set the checkbox state
                if (savedNames.trim() === DEFAULT_NAMES.trim()) {
                    loadDefaultsCheckbox.checked = true;
                } else {
                    loadDefaultsCheckbox.checked = false;
                }
                
                if (savedNames.trim().length > 0) {
                     window.loadNamesFromBulk(false); 
                }
            } else {
                // Initial load: Set initial default preference
                loadDefaultsCheckbox.checked = true;
                bulkInput.value = DEFAULT_NAMES;
                window.loadNamesFromBulk(false); 
            }
        }
        
        // --- Core List Management Functions ---

        window.saveCurrentList = function() {
            const bulkInput = document.getElementById('bulkInput');
            const currentContent = bulkInput.value;
            
            if (currentContent.trim().length === 0) {
                showMessage("List is empty. Nothing to save.", true);
                return;
            }

            let listName = prompt("Enter a name for this list:", "Team List " + (Object.keys(getSavedLists()).length + 1));
            
            if (!listName || listName.trim() === "") {
                showMessage("Save cancelled.", false);
                return;
            }
            listName = listName.trim();

            const savedLists = getSavedLists();
            savedLists[listName] = currentContent;

            try {
                localStorage.setItem(SAVED_LISTS_KEY, JSON.stringify(savedLists));
                populateListSelector(listName);
                document.getElementById('deleteListBtn').disabled = false; // Enable delete button after saving new list
                showMessage(`List "${listName}" saved successfully!`);
            } catch (e) {
                showMessage("Failed to save list to local storage.", true);
            }
        }
        
        window.loadSelectedList = function() {
            const selector = document.getElementById('listSelector');
            const listName = selector.value;
            
            document.getElementById('deleteListBtn').disabled = true; // Disable delete by default
            
            if (!listName) {
                return;
            }

            const savedLists = getSavedLists();
            const content = savedLists[listName];
            
            if (content) {
                const bulkInput = document.getElementById('bulkInput');
                const loadDefaultsCheckbox = document.getElementById('loadDefaults');
                
                bulkInput.value = content;
                
                // FIX: Update "Use Default List" checkbox based on loaded saved list content
                if (content.trim() === DEFAULT_NAMES.trim()) {
                    loadDefaultsCheckbox.checked = true;
                } else {
                    loadDefaultsCheckbox.checked = false;
                }

                // FIX: Pass false to suppress the message box on load from selector.
                window.loadNamesFromBulk(false); 
                document.getElementById('deleteListBtn').disabled = false; // Enable delete button for the loaded list
                showMessage(`List "${listName}" loaded.`);
            }
        }
        
        window.deleteSelectedList = function() {
            const selector = document.getElementById('listSelector');
            const listName = selector.value;
            
            if (!listName) return;

            if (confirm(`Are you sure you want to delete the list: "${listName}"?`)) {
                const savedLists = getSavedLists();
                
                // Check if the deleted list was the one currently loaded
                const bulkInput = document.getElementById('bulkInput');
                const content = savedLists[listName];
                const wasLoaded = (bulkInput.value === content);

                delete savedLists[listName];
                
                try {
                    localStorage.setItem(SAVED_LISTS_KEY, JSON.stringify(savedLists));
                    
                    if (wasLoaded) {
                        // Clear current input if the deleted list was showing
                        clearBulkInput();
                    }
                    
                    populateListSelector("");
                    showMessage(`List "${listName}" deleted.`);
                } catch (e) {
                    showMessage("Failed to delete list from local storage.", true);
                }
            }
        }

        window.clearBulkInput = function() {
            document.getElementById('bulkInput').value = "";
            document.getElementById('loadDefaults').checked = false;
            document.getElementById('listSelector').value = ""; // Reset selector on clear
            document.getElementById('deleteListBtn').disabled = true; // Disable delete
            window.loadNamesFromBulk(false);
            showMessage("Input list cleared.");
        }
        
        // --- Core Application Functions ---
        
        function renderNamesList(namesArray) {
            const selectionArea = document.getElementById('namesSelectionArea');
            selectionArea.innerHTML = ''; 
            
            if (namesArray.length === 0) {
                 selectionArea.innerHTML = '<p class="text-gray-500 text-base col-span-full">List is empty. Enter names in the Bulk Input area.</p>';
                 return;
            }

            namesArray.forEach((name, index) => {
                const div = document.createElement('div');
                // Use a standard Tailwind hover effect
                div.className = 'flex items-center space-x-2 py-1 px-2 rounded transition duration-100 hover:bg-indigo-50'; 
                div.innerHTML = `
                    <input type="checkbox" id="name-${index}" name="selectedName" value="${name}" checked 
                           class="h-4 w-4 text-indigo-600 border-gray-400 rounded focus:ring-indigo-500 cursor-pointer flex-shrink-0">
                    <label for="name-${index}" class="text-gray-800 cursor-pointer select-none truncate">${name}</label>
                `;
                selectionArea.appendChild(div);
            });
        }

        window.loadNamesFromBulk = function(showMsg = true) {
            const bulkInput = document.getElementById('bulkInput');
            const rawText = bulkInput.value;
            let names = rawText.split('\n')
                               .map(name => name.trim())
                               .filter(name => name.length > 0);
            
            if (names.length === 0) {
                renderNamesList([]);
                if (showMsg) showMessage("Input list is empty!", true);
                return;
            }
            
            renderNamesList(names);
            if (showMsg) showMessage(`Loaded ${names.length} names for selection.`);
            
            saveCurrentInput(rawText);
        }

        window.toggleDefaultNames = function(isChecked) {
            const bulkInput = document.getElementById('bulkInput');
            
            // 1. Update bulk input content
            if (isChecked) {
                bulkInput.value = DEFAULT_NAMES;
            } else {
                // Clear if the content matches the default, otherwise leave user's custom content
                if (bulkInput.value.trim() === DEFAULT_NAMES.trim()) {
                    bulkInput.value = "";
                }
            }
            
            // FIX: Reset selector on toggle to prevent sync issues with saved lists.
            document.getElementById('listSelector').value = ""; 
            document.getElementById('deleteListBtn').disabled = true;

            // Always call loadNamesFromBulk() after toggling, to refresh the selection area and save current state.
            window.loadNamesFromBulk(true); 
        }

        function showMessage(text, isError = false) {
            const messageBox = document.getElementById('messageBox');
            messageBox.textContent = text;
            messageBox.style.display = 'block';
            messageBox.classList.remove('opacity-0', 'bg-red-100', 'text-red-700', 'bg-green-100', 'text-green-700');

            if (isError) {
                messageBox.classList.add('bg-red-100', 'text-red-700');
            } else {
                messageBox.classList.add('bg-green-100', 'text-green-700');
            }

            setTimeout(() => {
                messageBox.classList.add('opacity-100');
            }, 10);
            
            setTimeout(() => {
                messageBox.classList.remove('opacity-100');
                messageBox.classList.add('opacity-0');
            }, 2000);

            setTimeout(() => {
                messageBox.style.display = 'none';
            }, 2300);
        }

        function shuffleArray(array) {
            let currentIndex = array.length, randomIndex;

            while (currentIndex != 0) {
                randomIndex = Math.floor(Math.random() * currentIndex);
                currentIndex--;

                [array[currentIndex], array[randomIndex]] = [
                    array[randomIndex], array[currentIndex]];
            }

            return array;
        }

        window.randomizeNames = function() {
            const resultTextarea = document.getElementById('resultTextarea');
            const copyButton = document.getElementById('copyButton');
            const checkboxes = document.querySelectorAll('#namesSelectionArea input[type="checkbox"]:checked');
            
            let names = Array.from(checkboxes).map(cb => cb.value);

            if (names.length === 0) {
                resultTextarea.value = "No names were selected for randomization. Please load a list and check one or more boxes.";
                copyButton.disabled = true;
                showMessage("No names selected!", true);
                return;
            }

            const shuffledNames = shuffleArray(names);

            const numberedList = shuffledNames.map((name, index) => {
                return `${index + 1}. ${name}`;
            }).join('\n');

            resultTextarea.value = numberedList;
            copyButton.disabled = false;
            showMessage(`Successfully randomized and numbered ${names.length} selected names!`);
        }

        window.copyResult = function() {
            const resultTextarea = document.getElementById('resultTextarea');
            
            if (resultTextarea.value.length === 0 || resultTextarea.value.includes("will appear here")) {
                showMessage("Nothing to copy yet!", true);
                return;
            }

            resultTextarea.select();
            
            try {
                document.execCommand('copy');
                showMessage("Randomized list copied to clipboard!");
            } catch (err) {
                console.error('Could not copy text: ', err);
                showMessage("Copy failed. Please select and copy manually.", true);
            }
        }

        window.onload = function() {
            populateListSelector();
            loadNamesFromLocalStorage();

            const bulkInput = document.getElementById('bulkInput');
            
            // Event listener for manual text input
            bulkInput.addEventListener('input', () => {
                // Reset selector on any manual typing
                document.getElementById('listSelector').value = ""; 
                document.getElementById('deleteListBtn').disabled = true; // Disable delete button on edit
                
                // Check if the bulk input content still matches the default list
                const loadDefaultsCheckbox = document.getElementById('loadDefaults');
                if (bulkInput.value.trim() === DEFAULT_NAMES.trim()) {
                    loadDefaultsCheckbox.checked = true;
                } else {
                    loadDefaultsCheckbox.checked = false;
                }

                // Debounce save to prevent constant localStorage writes
                clearTimeout(window.saveTimeout);
                window.saveTimeout = setTimeout(() => saveCurrentInput(bulkInput.value), 1000);
            });
        };
    </script>
</body>
</html>
